name: subabot
prefect-version: 3.0.9

build:
  - prefect.deployments.steps.run_shell_script:
      id: get-commit-hash
      script: git rev-parse --short HEAD
      stream_output: false
  - prefect_docker.deployments.steps.build_docker_image:
      id: build-image
      requires: prefect-docker
      image_name: dorukgezici/subabot
      dockerfile: Dockerfile.prefect
      tag: prefect-{{ get-commit-hash.stdout }}

pull:
  - prefect.deployments.steps.set_working_directory:
      directory: .

deployments:
  - name: subabot
    version: "prefect-latest"
    tags: []
    description:
    entrypoint: subabot/flows.py:rss_crawler
    parameters: {}
    work_pool:
      name: work-pool
      work_queue_name: default
      job_variables:
        image: "{{ build-image.image }}"
    enforce_parameter_schema: true
    schedules:
      - cron: 0 0 * * *
        timezone: UTC
        day_or: true
        active: true
        max_active_runs: 1
        catchup: false
    concurrency_limit: 1
