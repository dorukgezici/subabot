name: subabot
prefect-version: 3.0.10

build:
  - prefect.deployments.steps.run_shell_script:
      id: get-commit-hash
      script: git rev-parse --short HEAD
      stream_output: false
  - prefect_docker.deployments.steps.build_docker_image:
      id: build-image
      requires: prefect-docker>=0.6.1
      image_name: dorukgezici/subabot
      tag: prefect-{{ get-commit-hash.stdout }}
      dockerfile: Dockerfile.prefect
      platform: "linux/amd64"

push:
  - prefect_docker.deployments.steps.push_docker_image:
      requires: prefect-docker>=0.6.1
      image_name: "{{ build-image.image_name }}"
      tag: "{{ build-image.tag }}"

deployments:
  - name: subabot
    version: "{{ build-image.tag }}"
    tags: []
    description:
    entrypoint: subabot/flows.py:rss_crawler
    parameters: {}
    work_pool:
      name: workers
      work_queue_name: default
      job_variables:
        image: "{{ build-image.image }}"
    enforce_parameter_schema: true
    schedules:
      - cron: 0 0 * * *
        timezone: UTC
        day_or: true
        active: true
        max_active_runs: 1
        catchup: false
    concurrency_limit: 1
    pull:
      - prefect.deployments.steps.set_working_directory:
          directory: /app
