# Spacefile Docs: https://go.deta.dev/docs/spacefile/v0
v: 0
icon: frontend/static/img/subabot-512.png
micros:
  - name: frontend
    src: ./frontend
    engine: svelte-kit
    primary: true
    public: true
    dev: npm run dev
    presets:
      env:
        - name: PUBLIC_BACKEND_URL
          description: Subabot Backend URL
          default: "http://localhost:4200/api"
        - name: PUBLIC_SLACK_CLIENT_ID
          description: Slack Client ID

  - name: backend
    src: ./backend
    engine: python3.9
    path: api
    run: uvicorn app.main:app --workers 2
    dev: uvicorn app.main:app --reload --log-level debug
    presets:
      env:
        - name: SUBABOT_STAGE
          description: Subabot Stage
          default: "development"
        - name: SUBABOT_BACKEND_URL
          description: Subabot Backend URL
          default: "http://localhost:4200/api"
        - name: SUBABOT_FRONTEND_URL
          description: Subabot Frontend URL
          default: "http://localhost:4200"
        - name: SLACK_CLIENT_ID
          description: Slack Client ID
        - name: SLACK_CLIENT_SECRET
          description: Slack Client Secret
        - name: SLACK_SIGNING_SECRET
          description: Slack Signing Secret
        - name: SLACK_TEAM_ID
          description: Slack Team ID
        - name: SLACK_CHANNEL_ID
          description: Slack Channel ID
    actions:
      - id: "run_crawler"
        name: "Run Crawler"
        description: "Run crawler for RSS feeds"
        trigger: "schedule"
        default_interval: "5 minutes"
